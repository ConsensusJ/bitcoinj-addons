apply plugin: 'org.ajoberstar.git-publish'

def siteDir = "$buildDir/site"
def apiDocDir = "$buildDir/alljavadoc"

gitPublish {
    repoUri = 'git@github.com:ConsensusJ/consensusj.git'

    branch = 'gh-pages'

    // what to publish, this is a standard CopySpec
    contents {
        from(file("$siteDir")) {
            into '.'
        }
        from(file("$apiDocDir")) {
            into 'apidoc'
        }
    }

    // what to keep in the existing branch (include=keep)
//    preserve {
//        include '1.0.0/**'
//        exclude '1.0.0/temp.txt'
//    }

    commitMessage = 'Publishing via gradle' // defaults to 'Generated by gradle-git-publish'
}

gitPublishPush.dependsOn javadocAll, asciidoctor

task publishSite(dependsOn: gitPublishPush, group: 'render',
        description: "Publishes ${siteDir} to Github Pages on 'gh-pages' branch")
